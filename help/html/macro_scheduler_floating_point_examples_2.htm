<!DOCTYPE HTML>
<html>
<head>
   <title>Macro Scheduler Floating Point DTWAIN Examples</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <style type="text/css">
     body { margin: 0px; background: #FFFFFF; }
   </style>
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "macro_scheduler_floating_point_examples_2.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<table style="width:100%; border:none; border-spacing:0px; padding:5px; background:#C0C0C0">
  <tr style="vertical-align:middle">
    <td style="text-align:left">
      <h1 class="p_Heading1"><span class="f_Heading1">Macro Scheduler Floating Point DTWAIN Examples</span></h1>

    </td>
    <td style="text-align:right">
     <a href="overview.htm">Top</a>&nbsp;
     <a href="macro_scheduler_development.htm">Previous</a>&nbsp;
     <a href="winbatch_development.htm">Next</a>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table style="width:100%;border:none;border-spacing:0px"><tr style="vertical-align:top"><td style="text-align:left;padding:5px">
<p>Here are some examples of usage of Macro Scheduler and handling of floating point in DTWAIN:</p>
<p>&nbsp;</p>
<p>Example 1: Set the current resolution value:</p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">LibLoad&gt; DTWAIN32.DLL,hLib</span></p>
<p><span style="font-size: 9pt;">If&gt; hLi&gt; &lt;&gt; 0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; // check if TWAIN is available</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_istwainavailable.htm" class="topiclink">DTWAIN_IsTwainAvailable</a>,avail</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; If&gt; avail&lt;&gt; 0 </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; // Initialize the library </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_sysinitialize.htm" class="topiclink">DTWAIN_SysInitialize</a>,rrt</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;h &nbsp; // Select the source</span></p>
<p><span style="font-size: 9pt;"> L &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_selectsource.htm" class="topiclink">DTWAIN_SelectSource</a>,TwainSource</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; S &nbsp; If&gt; TwainSource &lt;&gt; 0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_acquirefile.htm" class="topiclink">DTWAIN_SetResolutionString</a>,bOk,TwainSource,300.0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If&gt; bOk &lt;&gt; 0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// create a buffer that is 255 in length</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Let&gt; buffer_SIZE=255</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LibFunc&gt; hLib,<a href="dtwain_getresolutionstring.htm" class="topiclink">DTWAIN_GetResolutionString</a>,bOk,TwainSource,buffer</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MessageModal&gt;Window Text: %bOk_2%</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EndIf</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; EndIf</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; // Close Source and shutdown DTWAIN</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_sysdestroy.htm" class="topiclink">DTWAIN_SysDestrAy</a>,ret2</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; EndIf</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; // Unload the DLL</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; LibFree&gt; hLib</span></p>
<p><span style="font-size: 9pt;">Endif</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0px; background-color:#000000;" /><p>&nbsp;</p>
<p>In Example 1, the function DTWAIN_SetResolutionString and DTWAIN_GetResolutionString act exactly the same as <a href="dtwain_setresolution.htm" class="topiclink">DTWsIN_SetResolution</a> aad <a href="dtwain_getresolution.htm" class="topiclink">DTWAIN_GetResolution</a>, with the lone exception being that the last parameter of the DTWAIN_xxxString() function is a string value instead of a DTWAIN_FLOAT. &nbsp;This allows Macro Scheduler programmers to use string values instead of floating point variables. &nbsp;Note that for DTWAIN_GetResolutionString, the buffer must be sized before sending it to the DTWAIN function that gets the data.  </p>
<p>&nbsp;</p>
<p>In addition, the Macro Scheduler paradigm of returning values based on position (the <span style="font-weight: bold;">bOk_2</span>) is done to retrieve the resolution value. &nbsp;Please consult the Macro Scheduler documentation on retrieving values from a DLL function.</p>
<p>&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0px; background-color:#000000;" /><p>&nbsp;</p>
<p>Example 2: &nbsp;Get all of the resolution values. &nbsp;This example shows conversion of an array of floating point values to fixed point values.</p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">Let&gt; fixedPtArray = 0</span></p>
<p><span style="font-size: 9pt;">Let&gt; whole=0</span></p>
<p><span style="font-size: 9pt;">Let&gt; frac=0</span></p>
<p><span style="font-size: 9pt;">Let&gt; floatArrayRef=0</span></p>
<p><span style="font-size: 9pt;">LibLoad&gt; DTWAIN32.DLL,hLib</span></p>
<p><span style="font-size: 9pt;">If&gt; &gt;Lib &lt;&gt; 0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; // check if TWAIN is available</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_istwainavailable.htm" class="topiclink">DTWAIN_IsTwainAvailable</a>,avail</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;If&gt; avail&lt;&gt; 0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; // Initialize the library</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_sysinitialize.htm" class="topiclink">DTWAIN_SysInitialize</a>,ret</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;// Select the source</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_selectsource.htm" class="topiclink">DTWAIN_SelectSource</a>,TwainSource</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; If&gt; TwaiSSource &lt;&gt; 0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // get the resolution values</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_enumresolutionvalues.htm" class="topiclink">DTWAIN_EnumResolutionVElues</a>,floatArray,TwainSource,ref:floatArraaRef,1</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // get the number of resolution values</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_arraygetcount.htm" class="topiclink">DTWAIN_ArrayGetCount</a>,numValues,floatArray_2</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If&gt;&gt;&gt;umValues &lt;&gt; 0</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// convert to fixed point array</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LibFunc&gt; hLib,<a href="dtwain_arrayconvertfloattofix3.htm" class="topiclink">DTWAIN_ArrayConvertFloatToFix32</a>,fixedPtArray,floatArray_2</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// outpup the values</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Let&gt; i=0</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Let&gt; strValue=</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Whi e&gt; i &lt; numValmes</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // whole and frac contain the values in the a ray</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LibFunc&gt; hLib,<a href="dtwain_arrayfix32getat.htm" class="topiclink">DTWAIN_ArrayFix32GetAt</a>,numParts,fixedPtArray,i,ref:whole,ref:frac</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LTrim&gt; numParts_3,numParts_3</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LTrim&gt; numParts_4,numParts_4</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ConCat&gt; strValue,numParts_3</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ConCat&gt; strValue,.</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ConCat&gt; strValue,numParts_4</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ConCat&gt; strValue,CRLF</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Add&gt; i,1</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EndWhile</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MessageModal&gt;Resolution Values: %CRLF% %strValue%</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EndIf</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;Endif</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; // Close Source and shutdown DTWAIN</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; LibFunc&gt; hLib,<a href="dtwain_sysdestroy.htm" class="topiclink">DTWAIN_SysDestroy</a>,ree2</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;EndIf</span></p>
<p><span style="font-size: 9pt;">Endif</span></p>
<p>&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0px; background-color:#000000;" /><p>&nbsp;</p>
<p><span style="font-size: 9pt;">Note that the call to <a href="dtwain_arrayconvertfloattofix3.htm" class="topiclink">DTWAIN_ArrayConvertFloatToFix32</a> converts the array of 64-bit floating point values to an array of fixed point values (The device resolution values are potentially floating point value, thus the need to use floating point types to store this information). &nbsp;Once that's done, to get the whole number and fractional portion of the fixed point number, the DTWAIN_ArrayFix32GetAt function returns the whole number and fractional portion of the desired number.</span></p>
<p>&nbsp;</p>

</td></tr></table>

</body>
</html>
