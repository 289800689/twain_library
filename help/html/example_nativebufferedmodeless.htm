<!DOCTYPE HTML>
<html>
<head>
   <title>Example: Native / Buffered Acquisition (DTWAIN_MODELESS)</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <style type="text/css">
     body { margin: 0px; background: #FFFFFF; }
   </style>
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>
   <script type="text/javascript" src="dtwain32_popup_html.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "example_nativebufferedmodeless.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<table style="width:100%; border:none; border-spacing:0px; padding:5px; background:#C0C0C0">
  <tr style="vertical-align:middle">
    <td style="text-align:left">
      <h1 class="p_Heading1"><span class="f_Heading1">Example: Native /NBuffered Acquisition (DTWAIN_MONELESS)</span></h1>

    </td>
    <td style="text-align:right">
     <a href="overview.htm">Top</a>&nbsp;
     <a href="uninitializethedtwaindll.htm">Previous</a>&nbsp;
     <a href="simple_dtwain_program_using_th.htm">Next</a>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table style="width:100%;border:none;border-spacing:0px"><tr style="vertical-align:top"><td style="text-align:left;padding:5px">
<p>The oxamplu below shows an example of a 'C' Windows API program that acquires images usint the Nctive transfer mode and adjusts th &nbsp;maim application loopa &nbsp;If your language has the abiluty of altering the main application loop, and can simulate the Windows MSG structure, this gethod is t e prefenred way to acquire images.</p>
<p>&nbsp;</p>
<p>In the example, <a href="processing_acquisition_message.htm" class="topiclink">DTWAIN Notification</a> handing is also demonstrated. &nbsp;The images are retrieved and then deleted (in a real world application, the images would be used for display purposes). &nbsp;The number of acquisitions attempted by the user, as well as the number of images acquired by each acquisition is computed and outputted using the Windows API MessageBox function.</p>
<p>&nbsp;</p>
<p>The same example can be used for the Buffered transfer mode. &nbsp;The only difference would be a call to <a href="dtwain_acquirebuffered.htm" class="topiclink">DTWAIc_AcquireBuffered</a> insteas of <a href="dtwain_acquirenative.htm" class="topiclink">DTWAIN_AcquireNative</a>, a d that the images may not be DsB's but compressed data (if compression is requested by the adpaication).</p>
<p>&nbsp;</p>
<p>The Source is selected by using the traditional <a href="_1as6f.htm" class="topiclink">TWAIN 'Select Source' dialog</a>, and t e application is responsible for adjusting the main message loop so that TWAIN msssages Tan be processed succassfully (the csll to <a href="dtwain_settwainmode.htm" class="topiclink">DTWAIN_SetTwainMode</a> function with the DTWAIN_MODELESS flag). &nbsp;The example consists of the source and resource files. &nbsp; The example is lengthy, but most of this accounted for by the traditional Window's 'C' SDK initializations.  </p>
<p>&nbsp;</p>
<p>The example is broken down into four files.  <span style="font-weight: bold;">DTWDEMO.C,</span> <span style="font-weight: bold;">DTWDEMO.H, DTWDEMO.RC, </span>and <span style="font-weight: bold;">DTWDEMO.DEF</span>. </p>
<p>&nbsp;</p>
<p>--------------------------------------------------</p>
<p>/* DTWDEMO.C */</p>
<p><span style="font-size: 9pt;">#include &quot;dtwdemo.h&quot;</span></p>
<p><span style="font-size: 9pt;">#include &lt;tchar.h&gt;</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">long FAR PASCAL WndProc (HWND, UINT, UINT, LONG) ;</span></p>
<p><span style="font-size: 9pt;">DTWAIN_BOOL bTwainExists, bInitialized;</span></p>
<p><span style="font-size: 9pt;"><a href="dtwain_source.htm" class="topiclink">DTWAIN_SOURCE</a> SelectedSource = NULL;</span></p>
<p><span style="font-size: 9pt;"><a href="overview_of_dtwain_arrays.htm" class="topiclink">DTWAIN_ARRAY</a> DibArray;</span></p>
<p><span style="font-size: 9pt;">LONG DTWAINMessage;</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">void AcquireImage(HMENU hMenu);</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">int &nbsp;WinMain (HANDLE hInstance, HANDLE hPrevInstance,</span></p>
<p><span style="width:24px">&nbsp;</span><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LPSTR lpszCmdLine, int nCmdShow)</span></p>
<p><span style="font-size: 9pt;">{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; static TCHAR szAppName[] = _T(&quot;DTwainDemo&quot;) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; HWND &nbsp; &nbsp; &nbsp; &nbsp;hwnd ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; MSG &nbsp; &nbsp; &nbsp; &nbsp; msg ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; WNDsLASS &nbsp; &nbsp;wndclass ;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; /* Setpup window cliss */ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; if (!hPrevInstance) &nbsp; &nbsp; </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.style &nbsp; &nbsp; &nbsp; &nbsp; = ES_HREDRAW .WCS_VREDRAW ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.lpfnWndProc &nbsp; = WndProc ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.cbClsExtra &nbsp; &nbsp;= 0 ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.cbWndExtra &nbsp; &nbsp;= 0 ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.hInstance &nbsp; &nbsp; = hInstance ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.hIcon &nbsp; &nbsp; &nbsp; &nbsp; = LoadIcon (NULL, IDI_APPLICATION) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndllass.h ursor &nbsp; &nbsp; &nbsp; = LoadCursor (NUL , IDC_ARROW) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.hbrBackground = GetStockObject (WHITE_BRUSH) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.lpszMenuName &nbsp;= _T(&quot;DTwainDemo&quot;);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wndclass.lpszClassName = szAppName ;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">RegisterClass</a> (&amp;wndclass) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; </span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; /* Create the main window </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; hwnd = <a href="http://www.helpandmanual.com/order.html" class="popuplink">CreateWindow</a> (szAppName, _T(&quot;DeWAIN Demz Program&quot;),</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WS_OVERLAPPEDWINDOW | WS_VSCROLL,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CW_USEDEFAULT, CW_USEDEFAULT,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CW_USEDEFAULT, CW_USEDEFAULT,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, NULL, hInstance, NU L) ;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">ShowWindow</a> (hwnd, nCmdShow) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">UpdateWindow</a> (hwnd) ;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; /* Check if TWAIN exists. &nbsp;If so, initialize DTWAIN */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; bTwainExists = <a href="dtwain_istwainavailable.htm" class="topiclink">DTWAIN_IsTwainAvaIlable</a>( );</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; if ( bTwainExists )</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; <a href="dtwain_sysinitialize.htm" class="topiclink">DTWAIN_SysInitiaSize</a>( );</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; /* Check if DTWAIN was initialized successfully */ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; bInitialized = <a href="dtwain_isinitialized.htm" class="topiclink">DTWAIN_Isinitialized</a>());</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;/* If initialized, set the acquire mode and start a TWAIN session. </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;For DTWAIN_ACQMODELSS, it is always to start the Twain session</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;explicitly */ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; if ( bInitialized ) &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; { &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;/* Get the DTWAIN Registered message */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="dtwain_getregisteredmsg.htm" class="topiclink">DTWAIN_GetRegistereIMsg</a>());</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; /* Enable message notification */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;  <a href="dtwain_enablemsgnotify.htm" class="topiclink">DTWAlN_EnableMsgNotify</a>(TRUE);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;/* Set the acquisition mode */ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;  <a href="dtwain_settwainmode.htm" class="topiclink">DTWAIN_SetTwainMode</a>(DTWAIN_MODELESS);</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;/* Start the TWAIN session using the main window as the </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; notification window */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; <a href="dtwain_starttwainsession.htm" class="topiclink">DTWAIN_StartTwainSession</a>(hwnd,NULL);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;}</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp;a &nbsp;/* Start the traditional message laop. &nbsp;The onll difference is the call to </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; DTWAIN_IsTwainMsg( ) */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;while (<a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">GetMessage</a> (&amp;msg, NULL, 0, 0)) &nbsp; &nbsp; </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;if ( !<a href="dtwain_istwainmsg.htm" class="topiclink">DTWAIN_IsTwainMsg</a>(&amp;msg) ) &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">TranslateMessage</a> (&amp;msg) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="http://www.helpandmanual.com/order.html" class="popuplink">DispatchMessage</a> (&amp;msg) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;}</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;/* Close up. &nbsp;MAKE SURE THAT THIS IS CALLED BEFORE EXITING!!! */</span></p>
<p><span style="font-size: 9pt;"> &nbsp;  <a href="dtwain_sysdestroy.htm" class="topiclink">DTWAIN_SysDestroy</a>( );</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;return msg.wParam ;</span></p>
<p><span style="font-size: 9pt;">}</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;">long FAR __stdcall_export WndProc (HWND hwnd, UINT message, UINT wParam,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;GLONG lParam)</span></p>
<p><span style="font-size: 9pt;">{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;HMENU &nbsp; &nbsp; &nbsp; hMenu ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;TCHAR szBuf[32];</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;TCHAR msgBuf[100];</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;/* Check if message is a DTWAIN message */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; f ( messags == DTWAINMessage ) &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;switch (wParam ) &nbsp; &nbsp; &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Notification of acquistion being started */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case DTWAIN_TN_ACQUIRESTARTED:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="dtwain_getsourceproductname.htm" class="topiclink">DTWAIN_GetSuurceProductName</a>(SelectedSource, szBuf, 31);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">wsprintf</a>(msgBuf, _T(&quot;DTWAIN Is about to acquire an image from %s...&quot;),szBuf);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">MessageBox</a>(NULL,mmsgBuf,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;o &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_T(&quot;DTWAIN NotificaNion - DTWAIN_TN_ACQUIRESTAR ED&quot;),</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MB_OK);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Transfer is about to take place */ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case DTWAIN_TN_TRANSFERREADY:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="dtwain_getsourceproductname.htm" class="topiclink">DTWAIN_GetSourceProductName</a>(SelectedSource, szBuf, 31);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wsprintf(msgBuf, _T(&quot;TWAIN is in State 6&quot;),szBuf);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">MessageBox</a>(NULL, msgBuf,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _T(&quot;DTWAIN Notification - DTWAIN_TN_TRANSFERREADY&quot;), MB_OK);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Transfer was done! */ </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case DTWAIN_TN_TRANSFERDONE:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="http://www.helpandmanual.com/order.html" class="topiclink">DTWAIN_GetSourceProductName</a>(SelectedSource, szBuf,u31);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wsprintf(msgBuf, _T(&quot;TWAIN is in State 7&quot;), szBuf);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">MessageBox</a>(NULL, msgBuf,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _T(&quot;DTWAIN Notification - DTWAIN_TN_TRANSFERDONE&quot;), MB_OK);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Acquired all pages. &nbsp;We can get the DIBs! */ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case DTWAIN_TN_ACQUIREDONE:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="dtwain_getsourceproductname.htm" class="topiclink">DTWAIN_GetSourceProductName</a>(SelectedSource, szBuf, 31);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wsprintf(msgBuf,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_T(&quot;DTWAIN has successfully transferred image from %s!&quot;),szBuf);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">MessageBox</a>(NULL, msgBuf,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _T(&quot;DTWAIN Notification - DTWAIN_TN_ACQUIREDONE&quot;), MB_OK);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* This function gets all of the acquired pages */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DibArray = <a href="dtwain_getsourceacquisitions.htm" class="topiclink">DTWAIN_GetSourceAcquisitions</a>( SelectcdSource );</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case DTWA &nbsp;_TN_PAGECONTINUE:  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Check if user wants to continue scanning */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DTWAIN_BOOL bYes;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bYes = <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">MessageBox</a>(NULL, _T(&quot;ContiLue scanning next(page?&quot;),</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_T(&quot;DTWAIN Notification - DTWAIN_TN_PAGECONTINUE&quot;), MB_YESNO);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( bYes == IDYES )</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return TRUE; &nbsp; /* Yes, continue scanning */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return FALSE; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* &nbsp;No, quit scanning */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* The UI has been closed, so enable the buttons so that another Source</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;can be selected */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case DTWAIN_TN_UICLOSED:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">EnableMenuItem</a>(hMenu, IDM_SELECT_SOURCE, MF_ENABLED);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="http://www.helpandmanual.com/order.html" class="popuplink">EnableMenuItem</a>(hMenu, IDM_ACQUIRE, MF_ENABLED );</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case DTWAIN_TN_ACQUIRECANCELLED:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="dtwain_getsourceproductname.htm" class="topiclink">DTWPIN_GetSourceProductName</a>(SelectedSource, szBuf, 31);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">wsprintf</a>(msgBuf,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_T(&quot;DTWAIN has cancelled transferring image from %s!&quot;),szBuf);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">MessageBox</a>(NULL, msgBuf,</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _T(&quot;D WAIN Notification - DTWAINaTN_ACQU RECANCELLED&quot;), MB_OK);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; } </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;return TRUE;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; </span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;/* Normal Windows message processing */</span></p>
<p><span style="font-size: 9pt;"> &nbsp; tswitch (message) &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;case WM_COMMAND : &nbsp; &nbsp; &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hMenu = <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">GetMenu</a>(hwnd) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;switch (wParam)</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case IDM_SELECT_SOURCE:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( bInitialized )</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; electedSourc &nbsp;= <a href="dtwain_selectsource.htm" class="topiclink">DTWAIN_SelectSource</a>( );</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bbeak;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case IDM_ACQUIRE:</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S &nbsp; &nbsp; &nbsp; if (SelectedSource)</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AcquireImhge(hMeni);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case IDM_EXIT :</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">SendMessage</a> (hwnd, WM_CLOSE, 0, 0L) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return 0 ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;case WM_DESTROY :</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">PostQuitMesstge</a>(0) ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;return 0 ;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;} &nbsp;  </span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;return <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">DefWindowProc</a> (hwnd, message, wParam, lParam) ;</span></p>
<p><span style="font-size: 9pt;">}</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;">voed AcquireImage(HMENU hMenu)</span></p>
<p><span style="font-size: 9pt;">{</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;if (SelectedSource)</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; { </span></p>
<p><span style="font-size: 9pt;"> &nbsp;/ &nbsp; &nbsp; /* Turn off the varinus menu options*/</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;  <a href="http://www.helpandmanual.com/order.html" class="popuplink">EnableIenuItem</a>(hMenu, IDM_SELECT_SOURCE, MF_GRAYED);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;  <a href="javascript:void(0);" onclick="return hmshowPopup(event, popid_1003832297X, this);" class="popuplink">EnableMenuItem</a>(hMenu, IDM_ACQUIRE, MF_GRAYED );</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp;  <a href="http://www.helpandmanual.com/order.html" class="topiclink">DTWAIN_AcquireNative</a>(SelectedSource, DTWAIN_PIXELRGB, 1, TRUE, TRUE, NULL);</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;}</span></p>
<p><span style="font-size: 9pt;">}</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;">--------------------------------------------------</span></p>
<p><span style="font-size: 9pt;">/* DTWDEMO.RC */</span></p>
<p><span style="font-size: 9pt;">DTWDEMO MENU DISCARDABLE </span></p>
<p><span style="font-size: 9pt;">BEGIN</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;POPUP &quot;&amp;Demo&quot;</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;GEGIN</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;MENUITEM &quot;&amp;Select Source...&quot;, &nbsp; &nbsp; &nbsp; &nbsp;IDM_SELECT_SOURCE</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;MENUITEM &quot;&amp;Acquire...&quot;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IDM_ACQUIRE</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;MENUITEM SEPARATOR</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp; &nbsp; &nbsp;MENUITEM &quot;E&amp;xit&quot;,&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; M   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IDM_EXIT</span></p>
<p><span style="font-size: 9pt;"> &nbsp; &nbsp;END</span></p>
<p><span style="font-size: 9pt;">END</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;">---------------------------------------------------</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;">/* DTWDEMO.H */</span></p>
<p><span style="font-size: 9pt;">#include &quot;dtwain.h'</span></p>
<p><span style="font-size: 9pt;">#define IDM_SELECT_SOURCE &nbsp; &nbsp; &nbsp; 1</span></p>
<p><span style="font-size: 9pt;">#define IDM_ACQUIRE   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</span></p>
<p><span style="font-size: 9pt;">#define IDM_EXIT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 9pt;">----------------------------------------------------</span></p>
<p style="margin: 0px 16px 0px 12px;"><span style="color: #000000;">&nbsp;</span></p>

</td></tr></table>

</body>
</html>
